<%- include('partials/header.ejs') %>

<!-- Navigation Bar -->
<nav class="navbar user-navbar">
  <div class="navbar-left">
    <h1 class="brand-title">üìò Vocab Notebook</h1>
  </div>
  <div class="navbar-right">
     <a href="/dashboard" class="nav-link">Home</a>
       <a href="/random" class="nav-link">Random Word</a>
    <a href="/logout" class="nav-link logout-link">Logout</a>
  </div>
</nav>

<!-- Search Section -->
<section class="search-section">
  <form method="POST" action="/search" id="searchForm" onsubmit="return false;" class="search">
    <input
      class="search-input"
      type="text"
      name="word"
      placeholder="Search for a new word..."
      required
    />
    <button class="search-btn" type="submit">üîç</button>
  </form>
</section>

<!-- Word Results -->
<main class="content">
  <% if (locals.error) { %>
    <div class="alert alert-error"><%= error %></div>
  <% } else if (data) { %>
    <% if (data.length < 1) { %>
      <p class="no-result">No words found</p>
    <% } else { %>
      <div class="word-results">
        <% data.forEach(word => { %>
          <div class="word-card">
            <p><strong>Word:</strong> <%= word.word %></p>
            <p><strong>Definition:</strong> <%= word.definition %></p>
            <p><strong>Pronunciation:</strong> <%= word.pronunciation %></p>
            <p><strong>Example:</strong> <%= word.example || '‚Äî' %></p>
            <a href="#"
               class="add-btn"
               data-word="<%= word.word %>"
               data-definition="<%= word.definition %>"
               data-pronunciation="<%= word.pronunciation %>"
               data-example="<%= word.example || '' %>">
               ‚ûï Add
            </a>
          </div>
        <% }); %>
      </div>
    <% } %>
  <% } %>
</main>

<!-- Add Word Modal -->
<div id="addModal" class="modal hidden">
  <div class="modal-content">
    <h2>Confirm Add</h2>
    <hr>
    <p id="add-message"></p>
    <div class="modal-actions">
      <button id="cancelAdd" type="button" class="btn btn-cancel">Cancel</button>
      <form id="addForm" method="POST">
        <input type="submit" value="Add Word" class="btn btn-primary"/>
      </form>
    </div>
  </div>
</div>

<script>
  const addModal = document.querySelector('#addModal');

  // Open Add Modal
  document.querySelectorAll('.add-btn').forEach(btn => {
    btn.addEventListener('click', e => {
      e.preventDefault();
      const word = btn.dataset.word;
      const definition = btn.dataset.definition;
      const pronunciation = btn.dataset.pronunciation;
      const example = btn.dataset.example;

      document.querySelector('#add-message').textContent =
        `Add "${word}" to your Word Bank?`;

      const addForm = document.querySelector('#addForm');
      addForm.action = "/add"; // backend uses session UID

      addForm.innerHTML = `
        <input type="hidden" name="word" value="${word}">
        <input type="hidden" name="definition" value="${definition}">
        <input type="hidden" name="pronunciation" value="${pronunciation}">
        <input type="hidden" name="example" value="${example}">
        <input type="submit" value="Add Word" class="btn btn-primary"/>
      `;

      addModal.classList.remove('hidden');
    });
  });

  document.querySelector('#cancelAdd').addEventListener('click', () => {
    addModal.classList.add('hidden');
  });

  addModal.addEventListener('click', e => {
    if (e.target === addModal) addModal.classList.add('hidden');
  });

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') addModal.classList.add('hidden');
  });

  // Safe search submission
  const searchForm = document.querySelector('#searchForm');
  searchForm.addEventListener('submit', e => {
    e.preventDefault();
    const word = searchForm.querySelector('input[name="word"]').value.trim();
    if (word) searchForm.submit();
  });
</script>



