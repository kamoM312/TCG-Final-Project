<div class="nav flex flex-horizontal">
  <div>
    <h1>Vocab Notebook</h1>
  </div>

  <div class="addStudent">
    <a href="/logout">Logout</a>
  </div>
</div>

<hr>

<div class="search">
  <form method="POST" action="/search" id="searchForm" onsubmit="return false;">
    <input class="searchText" type="text" name="word" placeholder="Search a word..." required />
    <button class="searchButton" type="submit">
      <i class="fa fa-circle-thin"></i>
    </button>
  </form>
</div>

<% if (locals.error) { %>
  <div class="error-message">
    <p><%= error %></p>
  </div>
<% } else if (data) { %>
  <% if (data.length < 1) { %>
    <p class="no-result">No words found</p>
  <% } else { %>
    <div class="student-container">
      <div class="student-header">
        <ul class="flex flex-horizontal">
          <li>Word</li>
          <li>Definition</li>
          <li>Pronunciation</li>
          <li>Actions</li>
        </ul>
      </div>

      <% data.forEach(word => { %>
        <div class="flex flex-horizontal student-item">
          <div><p><%= word.word %></p></div>
          <div><p><%= word.definition %></p></div>
          <div><p><%= word.pronunciation %></p></div>
          <div>
            <a href="#" class="add-btn" 
               data-word="<%= word.word %>"
               data-definition="<%= word.definition %>"
               data-pronunciation="<%= word.pronunciation %>"
               data-example="<%= word.example || '' %>">
              âž• Add
            </a>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>
<% } %>

<!-- Add Confirmation Modal -->
<div id="addModal" class="modal-background hidden">
  <div class="flex flex-vertical createForm deleteBorders">
    <h1>Confirm Add</h1>
    <hr>
    <p id="add-message"></p>
    <div class="flex flex-horizontal delete-modal-buttons">
      <button id="cancelAdd" type="button">Cancel</button>
      <form id="addForm" method="POST">
        <input type="submit" value="Add Word"/>
      </form>
    </div>
  </div>
</div>

<script>
  const addModal = document.querySelector('#addModal');

  // Open Add Modal
  document.querySelectorAll('.add-btn').forEach(btn => {
    btn.addEventListener('click', e => {
      e.preventDefault();
      const word = btn.dataset.word;
      const definition = btn.dataset.definition;
      const pronunciation = btn.dataset.pronunciation;
      const example = btn.dataset.example;

      // Update modal text
      document.querySelector('#add-message').textContent = 
        `Do you want to add the word "${word}" to your wordbank?`;

      // Set form action and hidden inputs
      const addForm = document.querySelector('#addForm');
      addForm.action = `/<%= userUid %>/add`;

      // Clear any previous hidden inputs
      addForm.innerHTML = `
        <input type="hidden" name="word" value="${word}">
        <input type="hidden" name="definition" value="${definition}">
        <input type="hidden" name="pronunciation" value="${pronunciation}">
        <input type="hidden" name="example" value="${example}">
        <input type="submit" value="Add Word"/>
      `;

      addModal.classList.remove('hidden');
    });
  });

  // Cancel Add
  document.querySelector('#cancelAdd').addEventListener('click', () => {
    addModal.classList.add('hidden');
  });

  // Close modal when clicking outside
  addModal.addEventListener('click', e => {
    if (e.target === addModal) addModal.classList.add('hidden');
  });

  // Close modal with Escape key
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') addModal.classList.add('hidden');
  });

  // Safe search submission
  const searchForm = document.querySelector('#searchForm');
  searchForm.addEventListener('submit', () => {
    const word = searchForm.querySelector('input[name="word"]').value.trim();
    if (word) searchForm.submit();
  });
</script>
